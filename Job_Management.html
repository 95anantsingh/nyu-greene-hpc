<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>7. Job Management &mdash; NYU Greene HPC 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="8. Jupyter Notebooks" href="Jupyter_Notebooks.html" />
    <link rel="prev" title="6. Anaconda" href="Anaconda.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #57068c" >
            <a href="index.html">
            <img src="_static/html_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Getting Started !</a></li>
<li class="toctree-l1"><a class="reference internal" href="Greene_HPC.html">1. Greene HPC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Greene_HPC.html#overview">1.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="Greene_HPC.html#software">1.2. Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="Greene_HPC.html#hardware">1.3. Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="Greene_HPC.html#network">1.4. Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="Greene_HPC.html#architecture">1.5. Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="Greene_HPC.html#workflow">1.6. Workflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Access.html">2. Access</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Access.html#nyu-vpn">2.1. NYU VPN</a></li>
<li class="toctree-l2"><a class="reference internal" href="Access.html#ssh">2.2. SSH</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Access.html#saving-ssh-keys">2.2.1. Saving SSH Keys</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Access.html#web-interface">2.3. Web Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Access.html#connection-to-ood">2.3.1. Connection to OOD</a></li>
<li class="toctree-l3"><a class="reference internal" href="Access.html#access-the-shell">2.3.2. Access the Shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="Access.html#interactive-applications">2.3.3. Interactive Applications</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Storage.html">3. Storage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Storage.html#file-systems">3.1. File Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="Storage.html#quota-utilization">3.2. Quota Utilization</a></li>
<li class="toctree-l2"><a class="reference internal" href="Storage.html#data-transfer">3.3. Data Transfer</a></li>
<li class="toctree-l2"><a class="reference internal" href="Storage.html#hpc-storage-status">3.4. HPC Storage Status</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Data_Sharing.html">4. Data Sharing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Data_Sharing.html#view-permissions">4.1. View Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Data_Sharing.html#modify-permissions">4.2. Modify Permissions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Data_Sharing.html#examples">4.2.1. Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Data_Sharing.html#share-a-file">4.2.1.1. Share a file</a></li>
<li class="toctree-l4"><a class="reference internal" href="Data_Sharing.html#share-a-directory-and-all-its-files">4.2.1.2. Share a directory and all its files</a></li>
<li class="toctree-l4"><a class="reference internal" href="Data_Sharing.html#share-all-new-files-in-a-directory">4.2.1.3. Share all new files in a directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="Data_Sharing.html#remove-a-permission-entry">4.2.1.4. Remove a permission entry</a></li>
<li class="toctree-l4"><a class="reference internal" href="Data_Sharing.html#remove-all-permissions">4.2.1.5. Remove all permissions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Software_Modules.html">5. Software Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Software_Modules.html#commands">5.1. Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="Software_Modules.html#examples">5.2. Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Anaconda.html">6. Anaconda</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Anaconda.html#one-time-setup">6.1. One Time Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="Anaconda.html#activate-conda">6.2. Activate conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="Anaconda.html#cheatsheet">6.3. Cheatsheet</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Anaconda.html#quick-start">6.3.1. Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="Anaconda.html#package-management">6.3.2. Package Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="Anaconda.html#environment-management">6.3.3. Environment Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="Anaconda.html#maintenance">6.3.4. Maintenance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">7. Job Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#batch-jobs">7.1. Batch Jobs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#batch-job-script">7.1.1. Batch Job Script</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#syntax">7.1.1.1. Syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#options">7.1.1.2. Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#submitting-a-batch-job">7.1.2. Submitting a batch Job</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reading-outputs">7.1.3. Reading Outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">7.1.4. Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interactive-sessions">7.2. Interactive Sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#checking-job-status">7.3. Checking Job Status</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running-or-pending-job">7.3.1. Running or Pending Job</a></li>
<li class="toctree-l3"><a class="reference internal" href="#completed-job">7.3.2. Completed Job</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cancelling-a-job">7.4. Cancelling a Job</a></li>
<li class="toctree-l2"><a class="reference internal" href="#job-resource-usage-statistics">7.5. Job Resource Usage Statistics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">7.5.1. Completed Job</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-job">7.5.2. Running job</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualize-job-statistics">7.5.3. Visualize Job Statistics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#resource-limitations">7.6. Resource Limitations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#job-limitations">7.6.1. Job Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cpu-gpu-ram-limitations">7.6.2. CPU, GPU, RAM Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cpu-with-gpu-limitations">7.6.3. CPU with GPU Limitations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hpc-resource-status">7.7. HPC Resource Status</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Jupyter_Notebooks.html">8. Jupyter Notebooks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Jupyter_Notebooks.html#one-time-setup">8.1. One time Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="Jupyter_Notebooks.html#add-jupyter-kernel">8.2. Add Jupyter Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="Jupyter_Notebooks.html#launch-jupyter-notebook">8.3. Launch Jupyter Notebook</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Visual_Studio_Code.html">9. Visual Studio Code</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Visual_Studio_Code.html#setup">9.1. Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Visual_Studio_Code.html#download-and-install">9.1.1. Download and Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="Visual_Studio_Code.html#connecting-to-hpc-cluster">9.1.2. Connecting to HPC cluster</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Visual_Studio_Code.html#workspace-management">9.2. Workspace Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="Visual_Studio_Code.html#recommended-extensions">9.3. Recommended Extensions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="FAQs.html">10. FAQs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="FAQs.html#what-are-login-nodes">10.1. What are Login Nodes?</a></li>
<li class="toctree-l2"><a class="reference internal" href="FAQs.html#what-are-compute-nodes">10.2. What are Compute Nodes?</a></li>
<li class="toctree-l2"><a class="reference internal" href="FAQs.html#what-resources-to-ask-for-and-how-much">10.3. What resources to ask for (and how much)?</a></li>
<li class="toctree-l2"><a class="reference internal" href="FAQs.html#why-my-jobs-are-queued">10.4. Why my jobs are queued?</a></li>
<li class="toctree-l2"><a class="reference internal" href="FAQs.html#how-to-find-more-information-on-my-jobs">10.5. How to find more information on my jobs?</a></li>
<li class="toctree-l2"><a class="reference internal" href="FAQs.html#how-busy-is-the-cluster">10.6. How busy is the cluster?</a></li>
<li class="toctree-l2"><a class="reference internal" href="FAQs.html#should-i-do-web-scraping-data-mining-from-websites-on-hpc">10.7. Should I do Web scraping, Data mining from websites on HPC?</a></li>
<li class="toctree-l2"><a class="reference internal" href="FAQs.html#how-to-check-if-i-am-wasting-ram-and-cpu">10.8. How to check if I am wasting RAM and CPU?</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Upcoming.html">Upcoming…</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Upcoming.html#have-suggestions">Have suggestions ?</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #57068c" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NYU Greene HPC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">7. </span>Job Management</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="job-management">
<h1><span class="section-number">7. </span>Job Management<a class="headerlink" href="#job-management" title="Permalink to this heading"></a></h1>
<p>On HPC, you don’t run your program on the shell directly (on login nodes). Instead you submit your program as a job to run on compute nodes. These jobs are managed by SLURM and will be queued to the system and executed eventually. Conceptually, each job is a 2-step process:</p>
<ol class="arabic simple">
<li><p>You request certain resources from the system. The most common resources are CPU cores.</p></li>
<li><p>With the assigned resources, you run your computational tasks.</p></li>
</ol>
<p>HPC provides flexibility in types of jobs as per the resource and computer requirements of its users. Down below are the most commonly used job types.</p>
<div class="hint admonition">
<p class="admonition-title">SLURM Useful Links</p>
<ul class="simple">
<li><p><a class="reference external" href="https://slurm.schedmd.com/quickstart.html">https://slurm.schedmd.com/quickstart.html</a></p></li>
<li><p><a class="reference external" href="https://slurm.schedmd.com/tutorials.html">https://slurm.schedmd.com/tutorials.html</a></p></li>
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=U42qlYkzP9k&amp;feature=player_embedded">https://www.youtube.com/watch?v=U42qlYkzP9k&amp;feature=player_embedded</a></p></li>
</ul>
</div>
<section id="batch-jobs">
<h2><span class="section-number">7.1. </span>Batch Jobs<a class="headerlink" href="#batch-jobs" title="Permalink to this heading"></a></h2>
<p>Users should use batch jobs for the most part unless your requirements can’t be met without a direct shell access.<br>
A complete batch job workflow:</p>
<ol class="arabic simple">
<li><p>Write a job script, which consists of 2 parts:</p>
<ol class="arabic simple">
<li><p>Resources requirement.</p></li>
<li><p>Commands to be executed.</p></li>
</ol>
</li>
<li><p>Submit the job.</p></li>
<li><p>Relax, have a coffee, log off if you wish. The computer will do the work.</p></li>
<li><p>Come back to examine the result.</p></li>
</ol>
<section id="batch-job-script">
<h3><span class="section-number">7.1.1. </span>Batch Job Script<a class="headerlink" href="#batch-job-script" title="Permalink to this heading"></a></h3>
<p>A job script is a text file describing the job. As discussed, the first part tells how much resources you want. The second part is what you want to run.</p>
<p><strong>Points to be noted:</strong></p>
<ul class="simple">
<li><p>Request only what you need</p></li>
<li><p>Serial jobs would need only one CPU (#SBATCH -n 1)</p></li>
<li><p>Make sure the walltime specified is not greater than the allowed time limit.</p></li>
</ul>
<div class="note admonition">
<p class="admonition-title">Difference between CPUs, Cores and Tasks</p>
<ul class="simple">
<li><p>On Greene HPC, One CPU is equivalent to one Core.</p></li>
<li><p>In Slurm, the resources (CPUs) are allocated in terms of tasks which are denoted by <code class="docutils literal notranslate"><span class="pre">-n</span></code> or <code class="docutils literal notranslate"><span class="pre">--natsks</span></code>.</p></li>
<li><p>By Default, the value of <code class="docutils literal notranslate"><span class="pre">-n</span></code> or <code class="docutils literal notranslate"><span class="pre">--ntasks</span></code> is one if left undefined.</p></li>
<li><p>By Default, Each task is equivalent to one CPU.</p></li>
<li><p>But if you have defined <code class="docutils literal notranslate"><span class="pre">-c</span></code> or <code class="docutils literal notranslate"><span class="pre">--cpus-per-task</span></code> in your job script, then the total number of CPUs allocated to you would be the multiple of <code class="docutils literal notranslate"><span class="pre">-n</span></code> and <code class="docutils literal notranslate"><span class="pre">-c</span></code>.</p></li>
</ul>
</div>
<section id="syntax">
<h4><span class="section-number">7.1.1.1. </span>Syntax<a class="headerlink" href="#syntax" title="Permalink to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># Define the resource requirements here using #SBATCH tag, </span>
<span class="c1"># (&#39;#&#39; before SBATCH is required and you do not remove it).</span>

<span class="c1">#------ Resource requiremenmt commands start here</span>

<span class="c1">#SBATCH &lt;option&gt; &lt;value&gt;</span>
<span class="c1">#SBATCH &lt;option&gt; &lt;value&gt;</span>
<span class="c1">#SBATCH &lt;option&gt; &lt;value&gt;</span>
...

<span class="c1">#------ Resource requiremenmt commands end here</span>

<span class="c1">#------ Commmands to be executed</span>

&lt;<span class="nb">command</span> executable on shell&gt;
&lt;<span class="nb">command</span> executable on shell&gt;
&lt;<span class="nb">command</span> executable on shell&gt;
...
</pre></div>
</div>
<p>Save the job scripts with <code class="docutils literal notranslate"><span class="pre">.sbatch</span></code> file extension.</p>
</section>
<section id="options">
<h4><span class="section-number">7.1.1.2. </span>Options<a class="headerlink" href="#options" title="Permalink to this heading"></a></h4>
<p>The options tell SLURM information about the job, such as what resources will be needed. These can be specified in the job-script as SBATCH directives, or on the command line as options while submitting a job, or both (in which case the command line options take precedence should the two contradict each other).</p>
<p>For each option there is a corresponding SBATCH directive with the syntax:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --nodes=2</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch abc.sbatch
</pre></div>
</div>
<p>or as a command-line option to sbatch when you submit the job:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch --nodes<span class="o">=</span><span class="m">2</span> abc.sbatch
</pre></div>
</div>
<p>Available options:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-J</span></code>, <code class="docutils literal notranslate"><span class="pre">--job-name=&lt;str&gt;</span></code></p></td>
<td><p>Give the job a name. The default is the filename of the job script. Within the job, $SBATCH_JOB_NAME <br> expands to the job name</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-o</span></code>, <code class="docutils literal notranslate"><span class="pre">--output</span> <span class="pre">&lt;path&gt;</span></code></p></td>
<td><p>Send stdout to path/for/stdout. The default filename is slurm-${SLURM_JOB_ID}.out, e.g. slurm-12345.out, <br> in the  directory from which the job was mitted</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">&lt;path&gt;</span></code></p></td>
<td><p>Send stderr to specified path</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--mail-user=&lt;email&gt;</span></code></p></td>
<td><p>Send email to specified email id when certain events occur</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--mail-type=&lt;type&gt;</span></code></p></td>
<td><p>Valid type values are NONE, BEGIN, END, FAIL, REQUEUE, ALL…</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--export=[VARS]</span></code></p></td>
<td><p>Pass variables to the job, either with a specific value (the VAR= form) or from the submittingenvironment <br>  (without “=”)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-t</span></code>, <code class="docutils literal notranslate"><span class="pre">--time=&lt;time&gt;</span></code></p></td>
<td><p>Set a limit on the total run time. Acceptable formats include  “minutes”, “minutes:seconds”, <br> “hours:minutes:seconds”,  “days-hours”, “days-hours:minutes” and “days-hours:minutes:seconds”</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--mem=&lt;int&gt;&lt;unit&gt;</span></code></p></td>
<td><p>Maximum memory per node the job will need, unit can be MB, GB, ex- 3GB</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--mem-per-cpu=&lt;int&gt;&lt;unit&gt;</span></code></p></td>
<td><p>Memory required per allocated CPU, unit can be MB, GB</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-N</span></code>, <code class="docutils literal notranslate"><span class="pre">--nodes=&lt;int&gt;</span></code></p></td>
<td><p>Number of nodes are required. Default is 1 node</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-n</span></code>, <code class="docutils literal notranslate"><span class="pre">--ntasks=&lt;int&gt;</span></code></p></td>
<td><p>Specify the number of tasks to run, e.g. -n4. Default is one CPU core per task. Don’t just submitthe job,<br>  but also wait for it to start and connect stdout, stderr and stdin to the current terminal, default is one task <br> per node</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--ntasks-per-node=&lt;int&gt;</span></code></p></td>
<td><p>Request that ntasks be invoked on each node</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-c</span></code>, <code class="docutils literal notranslate"><span class="pre">--cpus-per-task=&lt;int&gt;</span></code></p></td>
<td><p>Require ncpus number of CPU cores per task. Without this option, allocate one core per task</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--pty</span></code></p></td>
<td><p>Execute the first task in pseudo terminal mode, e.g. –pty /bin/bash, to start a bash command shell</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--x11</span></code></p></td>
<td><p>Enable X forwarding, so programs using a GUI can be used during the session (provided you have X <br>forwarding to your workstation set up)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--begin=&lt;time&gt;</span></code></p></td>
<td><p>Delay starting this job until after the specified date and time, e.g. –begin=9:42:00, to start the job at  <br>9:42:00 am</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-a</span></code>, <code class="docutils literal notranslate"><span class="pre">--array=[indexes]</span></code></p></td>
<td><p>Submit an array of jobs with array ids as specified. Array ids can be specified as a numerical range, a  <br>comma-separated list of numbers, or as some combination of the two. Each job instance will have an<br> environment variable SLURM_ARRAY_JOB_ID and SLURM_ARRAY_TASK_ID.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A more comprehensive list of options can be found <a class="reference external" href="https://slurm.schedmd.com/sbatch.html">here</a>.</p>
</div>
</section>
</section>
<section id="submitting-a-batch-job">
<h3><span class="section-number">7.1.2. </span>Submitting a batch Job<a class="headerlink" href="#submitting-a-batch-job" title="Permalink to this heading"></a></h3>
<p>To submit a job you need to use <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># sbatch [options] &lt;filename&gt;</span>
sbatch abc.sbatch
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Requesting the resources you need, as accurately as possible, allows your job to be started at the earliest opportunity as well as helping the system to schedule work efficiently to everyone’s benefit.</p>
</div>
</section>
<section id="reading-outputs">
<h3><span class="section-number">7.1.3. </span>Reading Outputs<a class="headerlink" href="#reading-outputs" title="Permalink to this heading"></a></h3>
<p>After a job execution finishes, a file is generated with the name specified in sbatch file which contains the <strong>stdout</strong> or the shell output. You can read the output by opening the output file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat job_1323234.out
</pre></div>
</div>
</section>
<section id="examples">
<h3><span class="section-number">7.1.4. </span>Examples<a class="headerlink" href="#examples" title="Permalink to this heading"></a></h3>
<p><strong>Job with one 1 core:</strong></p>
<p>Create a file  <code class="docutils literal notranslate"><span class="pre">python_program.sbatch</span></code> to run <code class="docutils literal notranslate"><span class="pre">abc.py</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH --ntasks=1              # Set number of tasks to run</span>
<span class="c1">#SBATCH --time=00:30:00         # Walltime format hh:mm:ss</span>
<span class="c1">#SBATCH -o job_%J.out           # Output file (%J: JobID)</span>
<span class="c1">#SBATCH -e job_%J.err           # Error file</span>

<span class="c1"># ---- Put all #SBATCH directives above this line! ---- #</span>
<span class="c1"># ---- Otherwise they will not be effective!       ---- #</span>

<span class="c1"># ---- Actual commands start here ---- #</span>
<span class="c1"># Load modules here (safety measure)</span>
module purge
module load python

python abc.py
</pre></div>
</div>
<p>Submit the job:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch python_program.sbatch
</pre></div>
</div>
<p><strong>A typical batch job script with GPU:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH --nodes=1               </span>
<span class="c1">#SBATCH --ntasks-per-node=1</span>
<span class="c1">#SBATCH --cpus-per-task=1</span>
<span class="c1">#SBATCH --time=5:00:00          # Walltime, expected time of job</span>
                                <span class="c1"># completion, SLURM can kill it </span>
                                <span class="c1"># after this time</span>
<span class="c1">#SBATCH --mem=2GB               # RAM</span>
<span class="c1">#SBATCH --gres=gpu:1            # 1 GPU</span>

<span class="c1">#SBATCH --job-name=myTest       # Assigned Job Name</span>
<span class="c1">#SBATCH --mail-type=END                 # Email on completion</span>
<span class="c1">#SBATCH --mail-user=bob.smith@nyu.edu   # Email</span>
<span class="c1">#SBATCH --output=slurm_%j.out           # Output file</span>
 
<span class="c1"># Clean environment</span>
module purge
module load cuda/11.3.1
module load anaconda3/2020.07 
<span class="nb">eval</span> <span class="s2">&quot;</span><span class="k">$(</span>conda shell.bash hook<span class="k">)</span><span class="s2">&quot;</span>

conda activate pytorch_env

<span class="nb">cd</span> <span class="nv">$SCRATCH</span>/Projects/DLProject
python resnet.py
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you want to select a specific GPU, you can specify that by <code class="docutils literal notranslate"><span class="pre">gpu:rtx8000:1</span></code> for Quadro RTX8000 and <code class="docutils literal notranslate"><span class="pre">gpu:v100:1</span></code> for Tesla V100.</p>
</div>
<div class="error admonition">
<p class="admonition-title">Warning</p>
<p>A job having a GPU resource is terminated if GPU usage is very low for 2 hours continuously.</p>
</div>
</section>
</section>
<section id="interactive-sessions">
<h2><span class="section-number">7.2. </span>Interactive Sessions<a class="headerlink" href="#interactive-sessions" title="Permalink to this heading"></a></h2>
<p>Instead of submitting a job, you could get an interactive session from your terminal on compute nodes, where you can run your program on the shell directly.</p>
<div class="error admonition">
<p class="admonition-title">Warning</p>
<p>Only short interactive jobs should be used (e.g., experimenting with new hyper-parameters in your source code taking a short runtime on each execution).</p>
</div>
<p>To start an interactive session <code class="docutils literal notranslate"><span class="pre">srun</span></code> command is used.<br>
Request a session with 4 CPU cores:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun -c <span class="m">4</span>  --pty /bin/bash
</pre></div>
</div>
<p>Expected output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>wz22@login-0-1<span class="o">]</span>$ srun -c <span class="m">4</span>  --pty /bin/bash
srun: job <span class="m">775175</span> queued and waiting <span class="k">for</span> resources
srun: job <span class="m">775175</span> has been allocated resources
<span class="o">[</span>wz22@compute-21-1 ~<span class="o">]</span>$
</pre></div>
</div>
<p>Then you can run your applications on the terminal directly.</p>
<div class="error admonition">
<p class="admonition-title">Warning</p>
<p>In a real scenario, the system might be exhausted with no available resources to you. You need to wait in this circumstance.</p>
</div>
<p>With interactive session you can have the same arguments passed to <code class="docutils literal notranslate"><span class="pre">srun</span></code> as you pass into the job script with <code class="docutils literal notranslate"><span class="pre">sbatch</span></code>.<br>
Request a GPU session with 32 GB RAM and 10 CPU cores for 1 hour:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun -c <span class="m">10</span> --mem<span class="o">=</span>32GB --gres<span class="o">=</span>gpu:1 -t <span class="m">1</span>:00:00 --pty /bin/bash
</pre></div>
</div>
<p>To leave an interactive batch session, type <code class="docutils literal notranslate"><span class="pre">exit</span></code> at the command prompt.</p>
</section>
<section id="checking-job-status">
<span id="job-status"></span><h2><span class="section-number">7.3. </span>Checking Job Status<a class="headerlink" href="#checking-job-status" title="Permalink to this heading"></a></h2>
<section id="running-or-pending-job">
<h3><span class="section-number">7.3.1. </span>Running or Pending Job<a class="headerlink" href="#running-or-pending-job" title="Permalink to this heading"></a></h3>
<p>This command shows all your current jobs.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>squeue -u &lt;NetID&gt;
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>JOBID PARTITION     NAME     USER ST       TIME NODES NODELIST<span class="o">(</span>REASON<span class="o">)</span>
<span class="m">31408</span>   ser_std  job1.sh     wz22  R       <span class="m">0</span>:02     <span class="m">1</span> compute-21-4
</pre></div>
</div>
<p>It means the job with Job ID <code class="docutils literal notranslate"><span class="pre">31408</span></code>, has running status (ST: <code class="docutils literal notranslate"><span class="pre">R</span></code>) and its runtime is 2 minutes on <code class="docutils literal notranslate"><span class="pre">compute-21-4</span></code> cluster node.</p>
<p>You can also get information about job status by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sstat --format<span class="o">=</span>TresUsageInMax%80,TresUsageInMaxNode%80 -j &lt;JobID&gt; --allsteps
</pre></div>
</div>
<p>For more verbose information, use scontrol show job.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scontrol show job &lt;jobid&gt;
</pre></div>
</div>
</section>
<section id="completed-job">
<h3><span class="section-number">7.3.2. </span>Completed Job<a class="headerlink" href="#completed-job" title="Permalink to this heading"></a></h3>
<p>Once the job is finished, the job can’t be inspected by <code class="docutils literal notranslate"><span class="pre">squeue</span></code> or <code class="docutils literal notranslate"><span class="pre">scontrol</span> <span class="pre">show</span> <span class="pre">job</span></code>. At this point, you could inspect the job by <code class="docutils literal notranslate"><span class="pre">sacct</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sacct -j &lt;jobid&gt;
</pre></div>
</div>
<p>The following commands give you extremely verbose information on a job.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sacct -j &lt;jobid&gt; -l
</pre></div>
</div>
</section>
</section>
<section id="cancelling-a-job">
<h2><span class="section-number">7.4. </span>Cancelling a Job<a class="headerlink" href="#cancelling-a-job" title="Permalink to this heading"></a></h2>
<p>If you decide to end a job prematurely, use <code class="docutils literal notranslate"><span class="pre">scancel</span></code> commmand.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scancel &lt;jobid&gt;
</pre></div>
</div>
<div class="caution admonition">
<p class="admonition-title">Use with caution !</p>
<p>To cancel all jobs from your account. Run this on the HPC terminal.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scancel -u &lt;NetID&gt;
</pre></div>
</div>
</div>
</section>
<section id="job-resource-usage-statistics">
<span id="job-resource-stat"></span><h2><span class="section-number">7.5. </span>Job Resource Usage Statistics<a class="headerlink" href="#job-resource-usage-statistics" title="Permalink to this heading"></a></h2>
<section id="id1">
<h3><span class="section-number">7.5.1. </span>Completed Job<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<p>A useful command that allows you to better understand how resources were utilized by completed jobs is <code class="docutils literal notranslate"><span class="pre">seff</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>seff &lt;job-ID&gt;
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Job ID: <span class="m">8932105</span>
Cluster: greene
User/Group: NetID/GROUPID
State: COMPLETED <span class="o">(</span><span class="nb">exit</span> code <span class="m">0</span><span class="o">)</span>
Cores: <span class="m">1</span>
CPU Utilized: <span class="m">02</span>:22:45
CPU Efficiency: <span class="m">99</span>.99% of <span class="m">02</span>:22:46 core-walltime
Job Wall-clock time: <span class="m">02</span>:22:46
Memory Utilized: <span class="m">2</span>.18 GB
Memory Efficiency: <span class="m">21</span>.80% of <span class="m">10</span>.00 GB
</pre></div>
</div>
<p>This example shows statistics on a completed job, that was ran with a request of 1 cpu core and 10Gb of RAM. While CPU utilization was 100%, RAM utilization was very poor – only 2.2GB out of requested 10GB was used. This job’s batch script should definitely be adjusted to something like #SBATCH –mem=2250MB</p>
</section>
<section id="running-job">
<h3><span class="section-number">7.5.2. </span>Running job<a class="headerlink" href="#running-job" title="Permalink to this heading"></a></h3>
<p>From login node, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>top -u &lt;NetID&gt;
</pre></div>
</div>
<p>Take a look how fully you use CPUs and how much RAM your jobs are using.<br>
To exit hit <code class="docutils literal notranslate"><span class="pre">Ctrl+C</span></code>
<br>
For a GPU job also run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nvidia-smi
</pre></div>
</div>
<p>Take a look how much GPU processing power your job is using.<br></p>
</section>
<section id="visualize-job-statistics">
<h3><span class="section-number">7.5.3. </span>Visualize Job Statistics<a class="headerlink" href="#visualize-job-statistics" title="Permalink to this heading"></a></h3>
<p>You can use the below dashboard to visualize the efficiency and utilization of your jobs:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://shiny.hpc.nyu.edu/user_feedback/">Job Statistics Dashboard</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You will have to login using your NYU email and you need to be on NYU Network or connected to <a class="reference internal" href="Access.html#nyu-vpn"><span class="std std-ref">NYU VPN</span></a>.</p>
</div>
</section>
</section>
<section id="resource-limitations">
<span id="id2"></span><h2><span class="section-number">7.6. </span>Resource Limitations<a class="headerlink" href="#resource-limitations" title="Permalink to this heading"></a></h2>
<p>Within SLURM there are multiple resource limits defined on different levels and applied to different objects. Some of the important limits are listed below:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note, that these limits are frequently updated by the HPC team, based on the cluster usage patterns. Due to this, the numbers above are not exact and should only be used as general guidelines.</p>
</div>
<section id="job-limitations">
<h3><span class="section-number">7.6.1. </span>Job Limitations<a class="headerlink" href="#job-limitations" title="Permalink to this heading"></a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Resource / Object per User</p></th>
<th class="head"><p>Limit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Concurrent Jobs</p></td>
<td><p>2000</p></td>
</tr>
<tr class="row-odd"><td><p>Job Lifetime</p></td>
<td><p>7 days / 168 hours (extendible)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="cpu-gpu-ram-limitations">
<h3><span class="section-number">7.6.2. </span>CPU, GPU, RAM Limitations<a class="headerlink" href="#cpu-gpu-ram-limitations" title="Permalink to this heading"></a></h3>
<p>These limitations are account specific and you need to run the command below to check yours:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sacctmgr list qos <span class="nv">format</span><span class="o">=</span>name,maxwall,maxtresperuser%40,flags%40 where <span class="nv">name</span><span class="o">=</span>interact,cpu48,cpu168,gpu48,gpu168,gpuamd,cds,cpuplus,gpuplus
</pre></div>
</div>
<p>Example Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>      Name     MaxWall                MaxTRESPU           Flags
---------- ----------- ------------------------ ---------------
     cpu48  <span class="m">2</span>-00:00:00       <span class="nv">cpu</span><span class="o">=</span><span class="m">3000</span>,mem<span class="o">=</span>6000G
    cpu168  <span class="m">7</span>-00:00:00       <span class="nv">cpu</span><span class="o">=</span><span class="m">1000</span>,mem<span class="o">=</span>2000G
     gpu48  <span class="m">2</span>-00:00:00              gres/gpu<span class="o">=</span><span class="m">24</span>
    gpu168  <span class="m">7</span>-00:00:00               gres/gpu<span class="o">=</span><span class="m">4</span>
</pre></div>
</div>
<p>From this you can see that in the “short queue” (under 48 hours, or 2 days) each user is allowed to utilize up to 3000 cores. For jobs that are running in the “long queue” (under 168 hours, or 7 days) you can use up to 1000 cores. Basic idea behind this – users can run more short jobs, and fewer long jobs. The same logic applies to GPU resources.</p>
</section>
<section id="cpu-with-gpu-limitations">
<h3><span class="section-number">7.6.3. </span>CPU with GPU Limitations<a class="headerlink" href="#cpu-with-gpu-limitations" title="Permalink to this heading"></a></h3>
<p><strong>For Tesla V100:</strong></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p># GPUs</p></th>
<th class="head"><p>Max CPUs</p></th>
<th class="head"><p>Max Memory</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>20</p></td>
<td><p>200</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>24</p></td>
<td><p>300</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>44</p></td>
<td><p>350</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>48</p></td>
<td><p>369</p></td>
</tr>
</tbody>
</table>
<p><strong>For Quadro RTX8000:</strong></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p># GPUs</p></th>
<th class="head"><p>Max CPUs</p></th>
<th class="head"><p>Max Memory</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>20</p></td>
<td><p>200</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>24</p></td>
<td><p>300</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>44</p></td>
<td><p>350</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>48</p></td>
<td><p>369</p></td>
</tr>
</tbody>
</table>
<p>From this table you can for example see, that a job asking for 8 V100 GPUs will not be queued. Another example is that requests for 2 V100s and 48 cores will also not be granted.</p>
</section>
</section>
<section id="hpc-resource-status">
<span id="resource-status"></span><h2><span class="section-number">7.7. </span>HPC Resource Status<a class="headerlink" href="#hpc-resource-status" title="Permalink to this heading"></a></h2>
<p>You can check current compute resource status of whole HPC using the below dashboards:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://graphs-out.hpc.nyu.edu/d/vA6e2Kgnk/greene-cluster-load-by-partitions-nyu-hpc-public?orgId=1&amp;theme=light&amp;refresh=30m&amp;from=now-14h&amp;to=now-5m&amp;kiosk=tv">Greene Cluster Load by Partition</a></p></li>
<li><p><a class="reference external" href="https://graphs-out.hpc.nyu.edu/d/CEVdMFR7z/greene-cluster-nyu-hpc-public?orgId=1&amp;theme=light&amp;refresh=5m&amp;from=now-14h&amp;to=now-5m&amp;kiosk=tv">Greene Resource Allocation, Utilization and Queue Status</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You need to be on NYU Network or connected to <a class="reference internal" href="Access.html#nyu-vpn"><span class="std std-ref">NYU VPN</span></a>.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
          <a href="Anaconda.html" class="btn btn-neutral float-left" title="6. Anaconda" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
          <a href="Jupyter_Notebooks.html" class="btn btn-neutral float-right" title="8. Jupyter Notebooks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      </div>
  
    <hr/>
  
    <div role="contentinfo">
      <p>&#169; Copyright 2022, <a href="https://www.github.com/95anantsingh">Anant Singh</a> | New York University |</p>
    </div> 
  
  </footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>