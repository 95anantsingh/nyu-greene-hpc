<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Job Management &mdash; NYU Greene HPC 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Jupyter Notebooks" href="Jupyter_Notebooks.html" />
    <link rel="prev" title="Anaconda" href="Anaconda.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #57068c" >
            <a href="index.html">
            <img src="_static/html_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Getting Started !</a></li>
<li class="toctree-l1"><a class="reference internal" href="Greene_HPC.html">Greene HPC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Greene_HPC.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="Greene_HPC.html#software">Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="Greene_HPC.html#hardware">Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="Greene_HPC.html#network">Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="Greene_HPC.html#architecture">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="Greene_HPC.html#workflow">Workflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Access.html">Access</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Access.html#outside-nyu-network">Outside NYU Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="Access.html#within-nyu-network">Within NYU Network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Access.html#ssh">SSH</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Access.html#saving-ssh-keys">Saving SSH Keys</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Access.html#web-interface">Web Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Access.html#connection-to-ood">Connection to OOD</a></li>
<li class="toctree-l4"><a class="reference internal" href="Access.html#access-the-shell">Access the shell</a></li>
<li class="toctree-l4"><a class="reference internal" href="Access.html#interactive-applications">Interactive Applications</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Storage.html">Storage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Storage.html#file-systems">File Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="Storage.html#hpc-storage-status">HPC Storage Status</a></li>
<li class="toctree-l2"><a class="reference internal" href="Storage.html#quota-utilization">Quota Utilization</a></li>
<li class="toctree-l2"><a class="reference internal" href="Storage.html#data-transfer">Data Transfer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Data_Sharing.html">Data Sharing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Data_Sharing.html#view-permissions">View Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Data_Sharing.html#modify-permissions">Modify Permissions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Data_Sharing.html#examples">Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Data_Sharing.html#share-a-file">Share a file</a></li>
<li class="toctree-l4"><a class="reference internal" href="Data_Sharing.html#share-a-directory-and-all-its-files">Share a directory and all its files</a></li>
<li class="toctree-l4"><a class="reference internal" href="Data_Sharing.html#share-all-new-files-in-a-directory">Share all new files in a directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="Data_Sharing.html#remove-a-specific-permission-entry">Remove a specific permission entry</a></li>
<li class="toctree-l4"><a class="reference internal" href="Data_Sharing.html#remove-all-permissions">Remove all permissions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Software_Modules.html">Software Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Software_Modules.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Anaconda.html">Anaconda</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Anaconda.html#one-time-setup">One Time Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="Anaconda.html#activate-conda">Activate conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="Anaconda.html#cheatsheet">Cheatsheet</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Anaconda.html#quick-start">Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="Anaconda.html#package-management">Package Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="Anaconda.html#environment-management">Environment Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="Anaconda.html#maintenance">Maintenance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Job Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#batch-jobs">Batch Jobs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#batch-job-script">Batch Job Script</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#syntax">Syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#options">Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#submitting-a-batch-job">Submitting a batch Job</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reading-outputs">Reading Outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interactive-sessions">Interactive Sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#checking-job-status">Checking Job Status</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#before-and-during-job-execution">Before and During Job Execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#after-job-completion">After Job Completion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cancelling-a-job">Cancelling a Job</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hpc-resource-status">HPC Resource Status</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Jupyter_Notebooks.html">Jupyter Notebooks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Jupyter_Notebooks.html#one-time-setup">One time Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="Jupyter_Notebooks.html#add-jupyter-kernel">Add Jupyter Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="Jupyter_Notebooks.html#launch-jupyter-notebook">Launch Jupyter Notebook</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Visual_Studio_Code.html">Visual Studio Code</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Visual_Studio_Code.html#setup">Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Visual_Studio_Code.html#download-and-install">Download and Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="Visual_Studio_Code.html#connecting-to-hpc-cluster">Connecting to HPC cluster</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Visual_Studio_Code.html#workspace-management">Workspace Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="Visual_Studio_Code.html#recommended-extensions">Recommended Extensions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Best_Practices.html">Best Practices</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Best_Practices.html#what-resources-to-ask-for-and-how-much">What resources to ask for (and how much)?</a></li>
<li class="toctree-l2"><a class="reference internal" href="Best_Practices.html#resource-usage-statistics">Resource Usage Statistics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Best_Practices.html#completed-job">Completed Job</a></li>
<li class="toctree-l3"><a class="reference internal" href="Best_Practices.html#running-job">Running job</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Best_Practices.html#why-my-jobs-are-queued">Why my jobs are queued?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Upcoming.html">Upcoming…</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Upcoming.html#have-suggestions">Have suggestions ?</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #57068c" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NYU Greene HPC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Job Management</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="job-management">
<h1>Job Management<a class="headerlink" href="#job-management" title="Permalink to this heading"></a></h1>
<p>On HPC, you don’t run your program on the shell directly (on login nodes). Instead you submit your program as a job to run on compute nodes. These jobs are managed by SLURM and will be queued to the system and executed eventually. Conceptually, each job is a 2-step process:</p>
<ol class="arabic simple">
<li><p>You request certain resources from the system. The most common resources are CPU cores.</p></li>
<li><p>With the assigned resources, you run your computational tasks.</p></li>
</ol>
<p>HPC provides flexibility in types of jobs as per the resource and computer requirements of its users. Down below are the most commonly used job types.</p>
<section id="batch-jobs">
<h2>Batch Jobs<a class="headerlink" href="#batch-jobs" title="Permalink to this heading"></a></h2>
<p>Users should use batch jobs for the most part unless your requirements can’t be met without a direct shell access.<br>
A complete batch job workflow:</p>
<ol class="arabic simple">
<li><p>Write a job script, which consists of 2 parts:</p>
<ol class="arabic simple">
<li><p>Resources requirement.</p></li>
<li><p>Commands to be executed.</p></li>
</ol>
</li>
<li><p>Submit the job.</p></li>
<li><p>Relax, have a coffee, log off if you wish. The computer will do the work.</p></li>
<li><p>Come back to examine the result.</p></li>
</ol>
<section id="batch-job-script">
<h3>Batch Job Script<a class="headerlink" href="#batch-job-script" title="Permalink to this heading"></a></h3>
<p>A job script is a text file describing the job. As discussed, the first part tells how much resources you want. The second part is what you want to run.</p>
<p><strong>Points to be noted:</strong></p>
<ul class="simple">
<li><p>Request only what you need</p></li>
<li><p>Serial jobs would need only one CPU (#SBATCH -n 1)</p></li>
<li><p>Make sure the walltime specified is not greater than the allowed time limit.</p></li>
</ul>
<div class="note admonition">
<p class="admonition-title">Difference between CPUs, Cores and Tasks</p>
<ul class="simple">
<li><p>On Greene HPC, One CPU is equivalent to one Core.</p></li>
<li><p>In Slurm, the resources (CPUs) are allocated in terms of tasks which are denoted by <code class="docutils literal notranslate"><span class="pre">-n</span></code> or <code class="docutils literal notranslate"><span class="pre">--natsks</span></code>.</p></li>
<li><p>By Default, the value of <code class="docutils literal notranslate"><span class="pre">-n</span></code> or <code class="docutils literal notranslate"><span class="pre">--ntasks</span></code> is one if left undefined.</p></li>
<li><p>By Default, Each task is equivalent to one CPU.</p></li>
<li><p>But if you have defined <code class="docutils literal notranslate"><span class="pre">-c</span></code> or <code class="docutils literal notranslate"><span class="pre">--cpus-per-task</span></code> in your job script, then the total number of CPUs allocated to you would be the multiple of <code class="docutils literal notranslate"><span class="pre">-n</span></code> and <code class="docutils literal notranslate"><span class="pre">-c</span></code>.</p></li>
</ul>
</div>
<section id="syntax">
<h4>Syntax<a class="headerlink" href="#syntax" title="Permalink to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># Define the resource requirements here using #SBATCH tag, </span>
<span class="c1"># (&#39;#&#39; before SBATCH is required and you do not remove it).</span>

<span class="c1">#------ Resource requiremenmt commands start here</span>

<span class="c1">#SBATCH &lt;option&gt; &lt;value&gt;</span>
<span class="c1">#SBATCH &lt;option&gt; &lt;value&gt;</span>
<span class="c1">#SBATCH &lt;option&gt; &lt;value&gt;</span>
...

<span class="c1">#------ Resource requiremenmt commands end here</span>

<span class="c1">#------ Commmands to be executed</span>

&lt;<span class="nb">command</span> executable on shell&gt;
&lt;<span class="nb">command</span> executable on shell&gt;
&lt;<span class="nb">command</span> executable on shell&gt;
...
</pre></div>
</div>
<p>Save the job scripts with <code class="docutils literal notranslate"><span class="pre">.sbatch</span></code> file extension.</p>
</section>
<section id="options">
<h4>Options<a class="headerlink" href="#options" title="Permalink to this heading"></a></h4>
<p>The options tell SLURM information about the job, such as what resources will be needed. These can be specified in the job-script as SBATCH directives, or on the command line as options while submitting a job, or both (in which case the command line options take precedence should the two contradict each other).</p>
<p>For each option there is a corresponding SBATCH directive with the syntax:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --nodes=2</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch abc.sbatch
</pre></div>
</div>
<p>or as a command-line option to sbatch when you submit the job:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch --nodes<span class="o">=</span><span class="m">2</span> abc.sbatch
</pre></div>
</div>
<p>Available options:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-J</span></code>, <code class="docutils literal notranslate"><span class="pre">--job-name=&lt;str&gt;</span></code></p></td>
<td><p>Give the job a name. The default is the filename of the job script. Within the job, $SBATCH_JOB_NAME <br> expands to the job name</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-o</span></code>, <code class="docutils literal notranslate"><span class="pre">--output</span> <span class="pre">&lt;path&gt;</span></code></p></td>
<td><p>Send stdout to path/for/stdout. The default filename is slurm-${SLURM_JOB_ID}.out, e.g. slurm-12345.out, <br> in the  directory from which the job was mitted</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">&lt;path&gt;</span></code></p></td>
<td><p>Send stderr to specified path</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--mail-user=&lt;email&gt;</span></code></p></td>
<td><p>Send email to specified email id when certain events occur</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--mail-type=&lt;type&gt;</span></code></p></td>
<td><p>Valid type values are NONE, BEGIN, END, FAIL, REQUEUE, ALL…</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--export=[VARS]</span></code></p></td>
<td><p>Pass variables to the job, either with a specific value (the VAR= form) or from the submittingenvironment <br>  (without “=”)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-t</span></code>, <code class="docutils literal notranslate"><span class="pre">--time=&lt;time&gt;</span></code></p></td>
<td><p>Set a limit on the total run time. Acceptable formats include  “minutes”, “minutes:seconds”, <br> “hours:minutes:seconds”,  “days-hours”, “days-hours:minutes” and “days-hours:minutes:seconds”</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--mem=&lt;int&gt;&lt;unit&gt;</span></code></p></td>
<td><p>Maximum memory per node the job will need, unit can be MB, GB, ex- 3GB</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--mem-per-cpu=&lt;int&gt;&lt;unit&gt;</span></code></p></td>
<td><p>Memory required per allocated CPU, unit can be MB, GB</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-N</span></code>, <code class="docutils literal notranslate"><span class="pre">--nodes=&lt;int&gt;</span></code></p></td>
<td><p>Number of nodes are required. Default is 1 node</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-n</span></code>, <code class="docutils literal notranslate"><span class="pre">--ntasks=&lt;int&gt;</span></code></p></td>
<td><p>Specify the number of tasks to run, e.g. -n4. Default is one CPU core per task. Don’t just submitthe job,<br>  but also wait for it to start and connect stdout, stderr and stdin to the current terminal, default is one task <br> per node</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--ntasks-per-node=&lt;int&gt;</span></code></p></td>
<td><p>Request that ntasks be invoked on each node</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-c</span></code>, <code class="docutils literal notranslate"><span class="pre">--cpus-per-task=&lt;int&gt;</span></code></p></td>
<td><p>Require ncpus number of CPU cores per task. Without this option, allocate one core per task</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--pty</span></code></p></td>
<td><p>Execute the first task in pseudo terminal mode, e.g. –pty /bin/bash, to start a bash command shell</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--x11</span></code></p></td>
<td><p>Enable X forwarding, so programs using a GUI can be used during the session (provided you have X <br>forwarding to your workstation set up)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--begin=&lt;time&gt;</span></code></p></td>
<td><p>Delay starting this job until after the specified date and time, e.g. –begin=9:42:00, to start the job at  <br>9:42:00 am</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-a</span></code>, <code class="docutils literal notranslate"><span class="pre">--array=[indexes]</span></code></p></td>
<td><p>Submit an array of jobs with array ids as specified. Array ids can be specified as a numerical range, a  <br>comma-separated list of numbers, or as some combination of the two. Each job instance will have an<br> environment variable SLURM_ARRAY_JOB_ID and SLURM_ARRAY_TASK_ID.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A more comprehensive list of options can be found <a class="reference external" href="https://slurm.schedmd.com/sbatch.html">here</a>.</p>
</div>
</section>
</section>
<section id="submitting-a-batch-job">
<h3>Submitting a batch Job<a class="headerlink" href="#submitting-a-batch-job" title="Permalink to this heading"></a></h3>
<p>To submit a job you need to use <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># sbatch [options] &lt;filename&gt;</span>
sbatch abc.sbatch
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Requesting the resources you need, as accurately as possible, allows your job to be started at the earliest opportunity as well as helping the system to schedule work efficiently to everyone’s benefit.</p>
</div>
</section>
<section id="reading-outputs">
<h3>Reading Outputs<a class="headerlink" href="#reading-outputs" title="Permalink to this heading"></a></h3>
<p>After a job execution finishes, a file is generated with the name specified in sbatch file which contains the <strong>stdout</strong> or the shell output. You can read the output by opening the output file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat job_1323234.out
</pre></div>
</div>
</section>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this heading"></a></h3>
<p><strong>Job with one 1 core:</strong></p>
<p>Create a file  <code class="docutils literal notranslate"><span class="pre">python_program.sbatch</span></code> to run <code class="docutils literal notranslate"><span class="pre">abc.py</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH --ntasks=1              # Set number of tasks to run</span>
<span class="c1">#SBATCH --time=00:30:00         # Walltime format hh:mm:ss</span>
<span class="c1">#SBATCH -o job_%J.out           # Output file (%J: JobID)</span>
<span class="c1">#SBATCH -e job_%J.err           # Error file</span>

<span class="c1"># ---- Put all #SBATCH directives above this line! ---- #</span>
<span class="c1"># ---- Otherwise they will not be effective!       ---- #</span>

<span class="c1"># ---- Actual commands start here ---- #</span>
<span class="c1"># Load modules here (safety measure)</span>
module purge
module load python

python abc.py
</pre></div>
</div>
<p>Submit the job:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch python_program.sbatch
</pre></div>
</div>
<p><strong>A typical batch job script with GPU:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH --nodes=1               </span>
<span class="c1">#SBATCH --ntasks-per-node=1</span>
<span class="c1">#SBATCH --cpus-per-task=1</span>
<span class="c1">#SBATCH --time=5:00:00          # Walltime, expected time of job</span>
                                <span class="c1"># completion, SLURM can kill it </span>
                                <span class="c1"># after this time</span>
<span class="c1">#SBATCH --mem=2GB               # RAM</span>
<span class="c1">#SBATCH --gres=gpu:1            # 1 GPU</span>

<span class="c1">#SBATCH --job-name=myTest       # Assigned Job Name</span>
<span class="c1">#SBATCH --mail-type=END                 # Email on completion</span>
<span class="c1">#SBATCH --mail-user=bob.smith@nyu.edu   # Email</span>
<span class="c1">#SBATCH --output=slurm_%j.out           # Output file</span>
 
<span class="c1"># Clean environment</span>
module purge
module load cuda/11.3.1
module load anaconda3/2020.07 
<span class="nb">eval</span> <span class="s2">&quot;</span><span class="k">$(</span>conda shell.bash hook<span class="k">)</span><span class="s2">&quot;</span>

conda activate pytorch_env

<span class="nb">cd</span> <span class="nv">$SCRATCH</span>/Projects/DLProject
python resnet.py
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you want to select a specific GPU, you can specify that by <code class="docutils literal notranslate"><span class="pre">gpu:rtx8000:1</span></code> for Quadro RTX8000 and <code class="docutils literal notranslate"><span class="pre">gpu:v100:1</span></code> for Tesla V100.</p>
</div>
<div class="error admonition">
<p class="admonition-title">Warning</p>
<p>A job having a GPU resource is terminated if GPU usage is very low for 2 hours continuously.</p>
</div>
</section>
</section>
<section id="interactive-sessions">
<h2>Interactive Sessions<a class="headerlink" href="#interactive-sessions" title="Permalink to this heading"></a></h2>
<p>Instead of submitting a job, you could get an interactive session from your terminal on compute nodes, where you can run your program on the shell directly.</p>
<div class="error admonition">
<p class="admonition-title">Warning</p>
<p>Only short interactive jobs should be used (e.g., experimenting with new hyper-parameters in your source code taking a short runtime on each execution).</p>
</div>
<p>To start an interactive session <code class="docutils literal notranslate"><span class="pre">srun</span></code> command is used.<br>
Request a session with 4 CPU cores:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun -c <span class="m">4</span>  --pty /bin/bash
</pre></div>
</div>
<p>Expected output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>wz22@login-0-1<span class="o">]</span>$ srun -c <span class="m">4</span>  --pty /bin/bash
srun: job <span class="m">775175</span> queued and waiting <span class="k">for</span> resources
srun: job <span class="m">775175</span> has been allocated resources
<span class="o">[</span>wz22@compute-21-1 ~<span class="o">]</span>$
</pre></div>
</div>
<p>Then you can run your applications on the terminal directly.</p>
<div class="error admonition">
<p class="admonition-title">Warning</p>
<p>In a real scenario, the system might be exhausted with no available resources to you. You need to wait in this circumstance.</p>
</div>
<p>With interactive session you can have the same arguments passed to <code class="docutils literal notranslate"><span class="pre">srun</span></code> as you pass into the job script with <code class="docutils literal notranslate"><span class="pre">sbatch</span></code>.<br>
Request a GPU session with 32 GB RAM and 10 CPU cores for 1 hour:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun -c <span class="m">10</span> --mem<span class="o">=</span>32GB --gres<span class="o">=</span>gpu:1 -t <span class="m">1</span>:00:00 --pty /bin/bash
</pre></div>
</div>
<p>To leave an interactive batch session, type <code class="docutils literal notranslate"><span class="pre">exit</span></code> at the command prompt.</p>
</section>
<section id="checking-job-status">
<h2>Checking Job Status<a class="headerlink" href="#checking-job-status" title="Permalink to this heading"></a></h2>
<section id="before-and-during-job-execution">
<h3>Before and During Job Execution<a class="headerlink" href="#before-and-during-job-execution" title="Permalink to this heading"></a></h3>
<p>This command shows all your current jobs.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>squeue -u &lt;NetID&gt;
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>JOBID PARTITION     NAME     USER ST       TIME NODES NODELIST<span class="o">(</span>REASON<span class="o">)</span>
<span class="m">31408</span>   ser_std  job1.sh     wz22  R       <span class="m">0</span>:02     <span class="m">1</span> compute-21-4
</pre></div>
</div>
<p>It means the job with Job ID <code class="docutils literal notranslate"><span class="pre">31408</span></code>, has running status (ST: <code class="docutils literal notranslate"><span class="pre">R</span></code>) and its runtime is 2 minutes on <code class="docutils literal notranslate"><span class="pre">compute-21-4</span></code> cluster node.</p>
<p>For more verbose information, use scontrol show job.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scontrol show job &lt;jobid&gt;
</pre></div>
</div>
</section>
<section id="after-job-completion">
<h3>After Job Completion<a class="headerlink" href="#after-job-completion" title="Permalink to this heading"></a></h3>
<p>Once the job is finished, the job can’t be inspected by <code class="docutils literal notranslate"><span class="pre">squeue</span></code> or <code class="docutils literal notranslate"><span class="pre">scontrol</span> <span class="pre">show</span> <span class="pre">job</span></code>. At this point, you could inspect the job by <code class="docutils literal notranslate"><span class="pre">sacct</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sacct -j &lt;jobid&gt;
</pre></div>
</div>
<p>The following commands give you extremely verbose information on a job.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sacct -j &lt;jobid&gt; -l
</pre></div>
</div>
</section>
</section>
<section id="cancelling-a-job">
<h2>Cancelling a Job<a class="headerlink" href="#cancelling-a-job" title="Permalink to this heading"></a></h2>
<p>If you decide to end a job prematurely, use <code class="docutils literal notranslate"><span class="pre">scancel</span></code> commmand.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scancel &lt;jobid&gt;
</pre></div>
</div>
<div class="caution admonition">
<p class="admonition-title">Use with caution !</p>
<p>To cancel all jobs from your account. Run this on the HPC terminal.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scancel -u &lt;NetID&gt;
</pre></div>
</div>
</div>
</section>
<section id="hpc-resource-status">
<h2>HPC Resource Status<a class="headerlink" href="#hpc-resource-status" title="Permalink to this heading"></a></h2>
<p>You can check current HPC compute resource status using the below dashboards:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://graphs-out.hpc.nyu.edu/d/vA6e2Kgnk/greene-cluster-load-by-partitions-nyu-hpc-public?orgId=1&amp;theme=light&amp;refresh=30m&amp;from=now-14h&amp;to=now-5m&amp;kiosk=tv">Greene Cluster Load by Partition</a></p></li>
<li><p><a class="reference external" href="https://graphs-out.hpc.nyu.edu/d/CEVdMFR7z/greene-cluster-nyu-hpc-public?orgId=1&amp;theme=light&amp;refresh=5m&amp;from=now-14h&amp;to=now-5m&amp;kiosk=tv">Greene Resource Allocation &amp; Utilization, Queue Status</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You need to be on NYU Network or connect to NYU VPN, refer <a class="reference internal" href="Access.html#access"><span class="std std-ref">Access</span></a>.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
          <a href="Anaconda.html" class="btn btn-neutral float-left" title="Anaconda" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
          <a href="Jupyter_Notebooks.html" class="btn btn-neutral float-right" title="Jupyter Notebooks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      </div>
  
    <hr/>
  
    <div role="contentinfo">
      <p>&#169; Copyright 2022, <a href="https://www.github.com/95anantsingh">Anant Singh</a> | New York University |</p>
    </div> 
  
  </footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>